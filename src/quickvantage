#!/bin/bash

if [ "$(id -u)" -ne 0 ]; then
    echo "🔒 Requesting super-user privileges..."
    exec sudo "$0" "$@"
    exit 1
fi

# Path variables (add your custom variables here for better maintainability)
CONSERVATION_PATH="/sys/bus/platf*/drivers/ideap*/VPC*/conser*"
FN_LOCK_PATH="/sys/bus/platf*/drivers/ideap*/VPC*/fn*"

# Toggle Conservation Mode
toggle_conservation() {
    current=$(cat $CONSERVATION_PATH 2>/dev/null)
    if [ "$current" -eq 1 ]; then
        echo 0 > $CONSERVATION_PATH
        echo "❌ Conservation Mode disabled"
    else
        echo 1 > $CONSERVATION_PATH
        echo "✅ Conservation Mode enabled"
    fi
}

# Toggle Function Lock
toggle_fn_lock() {
    current=$(cat $FN_LOCK_PATH 2>/dev/null)
    if [ "$current" -eq 1 ]; then
        echo 0 > $FN_LOCK_PATH
        echo "❌ Function Lock disabled"
    else
        echo 1 > $FN_LOCK_PATH
        echo "✅ Function Lock enabled"
    fi
}

# Current status function
show_status() {
    cons=$(cat $CONSERVATION_PATH 2>/dev/null)
    fn=$(cat $FN_LOCK_PATH 2>/dev/null)
    # p and q is computed earlier to lessen the clutter inside the menu
    p=$( [ "$cons" -eq 1 ] && echo "[ ON]" || echo "[OFF]" )
    q=$( [ "$fn" -eq 1 ] && echo "[ ON]" || echo "[OFF]" )
    echo "._______________________________."
    echo "|         Quick-Vantage         |"
    echo "|===============================|"
    echo "|  Current Status:              |"
    echo "|  - Conservation Mode: $p   |"
    echo "|  - Function Lock:     $q   |"
    echo "|===============================|"
    echo "|  Options:                     |"
    echo "|  1) Toggle Conservation Mode  |"
    echo "|  2) Toggle Function Lock      |"
    echo "|  q) Quit                      |"
    echo "|_______________________________|"
}

# Main script
while true; do
    show_status
    echo
    read -p "Choose an option (1-2, q): " choice
    
    case $choice in
        1) toggle_conservation ;;
        2) toggle_fn_lock ;;
        q|Q) 
            echo "Goodbye!"
            exit 0
            ;;
        *) 
            echo "Invalid option, please try again"
            ;;
    esac
    
    sleep 1  # Added delay so that the user can see the updates live
done